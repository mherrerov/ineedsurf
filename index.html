<!DOCTYPE html>
<html>
<head>
    <title>Newspaper-Like Login</title>

    <!-- Include the modified ATS script with additional logic -->
    <script>
        // Replace this part with the actual content of the external ats.js file
        // Ensure that atsenvelopemodule is defined globally in this script
        // ...

        // Function to hash the email using SHA-256
        async function hashEmail(email) {
            const encoder = new TextEncoder();
            const data = encoder.encode(email);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(byte => byte.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        // Function to set additional data for the ATS envelope module
        function setEnvelopeData(email) {
            // Use the hashed email for privacy purposes
            hashEmail(email).then(hashedEmail => {
                // For example, you can directly feed it emails
                atsenvelopemodule.setAdditionalData({
                    'type': 'email',
                    'id': hashedEmail
                });
            });
        }

        // ATS envelope module is ready to be used
        window.addEventListener("envelopeModuleReady", () => {
            // Get the raw email from the input field
            const emailInput = document.getElementById("email");
            const email = emailInput.value;

            // Validate email format
            if (!isValidEmail(email)) {
                alert("Invalid email format");
                return;
            }

            // Set additional data for the ATS envelope module
            setEnvelopeData(email);
        });

        // Function to validate email format (you can improve this)
        function isValidEmail(email) {
            const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
            return emailPattern.test(email);
        }
    </script>
    <!-- Include the external scripts in the header -->
    <script async defer src="https://ats-wrapper.privacymanager.io/ats-modules/f9eb6199-697c-4cb1-827d-ff441eb710ef/ats.js"></script>

    <style>
        body {
            font-family: 'Times New Roman', Times, serif;
            background-color: #f2f2f2;
            text-align: center;
        }
        .container {
            margin: 50px auto;
            padding: 20px;
            width: 400px;
            background-color: #fff;
            border: 1px solid #ccc;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            font-size: 36px;
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
        }
        button.login-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin-top: 10px;
            cursor: pointer;
        }
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            background-color: #fff;
            border: 1px solid #ccc;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Newspaper Login</h1>
        <form id="loginForm">
            <input type="text" id="email" placeholder="Email" required>
            <input type="password" id="password" placeholder="Password" required>
            <button type="button" class="login-button" onclick="performLogin()">Login</button>
        </form>
    </div>

    <div id="myModal" class="modal">
        <span class="close" onclick="closeModal()">&times;</span>
        <p id="loginMessage"></p>
    </div>

    <script>
        // Rest of your existing JavaScript code
        function performLogin() {
            const emailInput = document.getElementById("email");
            const email = emailInput.value;

            // Validate email format
            if (!isValidEmail(email)) {
                alert("Invalid email format");
                return;
            }

            hashEmail(email).then(hashedEmail => {
                // Set the hashed_email value in a cookie named "forenvelopecreation"
                document.cookie = `forenvelopecreation=${hashedEmail}; path=/`;

                // Send the raw email to ATS
                setEnvelopeData(email);

                // You can redirect to the "thankyoupage.html" with the email as a parameter
                const encodedEmail = encodeURIComponent(hashedEmail);
                window.location.href = `thankyoupage.html?email=${encodedEmail}`;
            });
        }

        function closeModal() {
            const modal = document.getElementById("myModal");
            modal.style.display = "none";
        }
    </script>
</body>
</html>
